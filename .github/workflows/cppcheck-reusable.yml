name: "Reusable cppcheck workflow"

on:
  workflow_call:

jobs:
  cppcheck:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/hrzlgnm/actions-github-cppcheck:v1@sha256:20b22af750fd935a891423933a0414b4c11629654c7366c60b0d9ba9ba15ea07

    steps:
      - name: üîÑ Checkout
        uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6

      - name: ‚öôÔ∏è Configure
        run: >-
          cmake
          -GNinja
          -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
          -S .
          -B ../build

      - name: üìòüîçCppcheck
        run: |
          echo "Checking with $(cppcheck --version)"
          cppcheck \
          --check-level=exhaustive \
          --project=../build/compile_commands.json \
          --library=cppcheck/${{ github.event.repository.name }}.cfg \
          --enable=style,performance,warning,portability \
          --inline-suppr \
          --suppress=cppcheckError \
          --suppress=internalAstError \
          --suppress=unmatchedSuppression \
          --suppress=syntaxError \
          --suppress=preprocessorErrorDirective \
          --suppress='*:fmt/*' \
          --error-exitcode=2

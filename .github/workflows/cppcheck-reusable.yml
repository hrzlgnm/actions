name: "Reusable cppcheck workflow"

on:
  workflow_call:

jobs:
  cppcheck:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/hrzlgnm/actions-github-cppcheck:v1@sha256:0195feab3acd7cce1881a7b4a4f238d96e49943b2a368b432aad99114b113f29

    steps:
      - name: üîÑ Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

      - name: ‚öôÔ∏è Configure
        run: >-
          cmake
          -GNinja
          -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
          -S .
          -B ../build

      - name: üìòüîçCppcheck
        run: |
          echo "Checking with $(cppcheck --version)"
          cppcheck \
          --check-level=exhaustive \
          --project=../build/compile_commands.json \
          --library=cppcheck/${{ github.event.repository.name }}.cfg \
          --enable=style,performance,warning,portability \
          --inline-suppr \
          --suppress=cppcheckError \
          --suppress=internalAstError \
          --suppress=unmatchedSuppression \
          --suppress=syntaxError \
          --suppress=preprocessorErrorDirective \
          --suppress='*:fmt/*' \
          --error-exitcode=2

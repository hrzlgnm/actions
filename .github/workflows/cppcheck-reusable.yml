name: "Reusable cppcheck workflow"

on:
  workflow_call:

jobs:
  cppcheck:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/hrzlgnm/actions-github-cppcheck:v1@sha256:c8d323ec5e3f1439c51ea6b325ac0bf0b5cb729508837e479e33b117d9e4c289

    steps:
      - name: ğŸ”„ Checkout
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3 # v6

      - name: âš™ï¸ Configure
        run: >-
          cmake
          -GNinja
          -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
          -S .
          -B ../build

      - name: ğŸ“˜ğŸ”Cppcheck
        run: |
          echo "Checking with $(cppcheck --version)"
          cppcheck \
          --inline-suppr \
          --check-level=exhaustive \
          --project=../build/compile_commands.json \
          --library=cppcheck/${{ github.event.repository.name }}.cfg \
          --enable=style \
          --suppress='*:fmt/*' \
          --error-exitcode=2
